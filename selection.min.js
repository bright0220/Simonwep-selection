/*! Selection 0.0.2 - MIT | git://github.com/Simonwep/Selection.git */

(function(a){'use strict';if('undefined'!=typeof module&&'undefined'!=typeof module.exports)module.exports=a();else if('undefined'!=typeof window&&window.document)window.Selection=a();else throw new Error('selection.js requires a window with a document')})(function(){'use strict';function a(a){this.options=a?a:{};let c={class:'selection-area',startThreshold:0,disableTouch:!1,containers:[],selectables:[],startareas:['html'],boundarys:['html']};for(let b in c)b in a||(a[b]=c[b]);for(let b in this)'_'===b.charAt(0)&&'function'==typeof this[b]&&(this[b]=this[b].bind(this));this.areaElement=(()=>{const a=document.createElement('div');return document.body.appendChild(a),d(a,{top:0,left:0,position:'fixed'}),a})(),b(document,'mousedown',this._onTapStart),this.options.disableTouch||b(document,'touchstart',this._onTapStart)}function b(a,b,c){a.addEventListener(b,c,!1)}function c(a,b,c){a.removeEventListener(b,c,!1)}function d(a,b,c){const d=a&&a.style;if(d)if('object'==typeof b){const a=Object.getOwnPropertyNames(b);for(let c of a){let a=b[c];d[c]=a+('string'==typeof a?'':'px')}}else{if(void 0===c)return document.defaultView&&document.defaultView.getComputedStyle?c=document.defaultView.getComputedStyle(a,null):a.currentStyle&&(c=a.currentStyle),void 0===prop?c:c[b];if(!(b in d))for(let a of k)d[a+b]=c+('string'==typeof c?'':'px');else d[b]=c+('string'==typeof c?'':'px')}}function e(a,b){function c(a){for(let d of a.children)b(d),c(d,b)}Array.isArray(a)||(a=[a]);for(let d of a)c(d)}function f(c,d){const e=c.getBoundingClientRect(),a=d.getBoundingClientRect();return e.x+e.width>=a.x&&e.x<=a.x+a.width&&e.y+e.height>=a.y&&e.y<=a.y+a.height}function g(a,b,c){const d=a.options[b];if('function'==typeof d){return d.call(a,{selection:a,eventName:b,element:c})}}function h(a,b,c,d,e,f){const g=a.options[b];if('function'==typeof g){return g.call(a,{selection:a,eventName:b,areaElement:c,selectedElements:e,changedElements:f,originalEvent:d})}}function i(a){Array.isArray(a)||(a=[a]);const b=[];for(let c of a)b.push(...document.querySelectorAll(c));return b}function j(a){const b=[];for(let c=a.target;c=c.parentElement;)b.push(c);return b.push(document),b.push(window),b}const k=['-moz-','-ms-','-o-','-webkit-'],l=Math.abs,m=Math.max,n=Math.min;return a.prototype={constructor:a,_onTapStart(a){const c=a.touches&&a.touches[0],d=(c||a).target,e=i(this.options.startareas);this._boundarys=i(this.options.boundarys),!1!==g(this,'startFilter',d)&&e.find(b=>j(a).includes(b))&&this._boundarys.find(b=>j(a).includes(b))&&(this._lastX=(c||a).clientX,this._lastY=(c||a).clientY,this._containers=i(this.options.containers),this._selectables=i(this.options.selectables),this._targetBoundary=this._boundarys.find(a=>f(a,d)),this._touchedElements=[],this._changedElements={added:[],removed:[]},this.areaElement.classList.add(this.options.class),b(document,'mousemove',this._delayedTapMove),b(document,'touchmove',this._delayedTapMove),b(document,'mouseup',this._onTapStop),b(document,'touchcancel',this._onTapStop),b(document,'touchend',this._onTapStop),h(this,'onStart',this.areaElement,a,this._touchedElements,this._changedElements))},_delayedTapMove(a){const e=a.touches&&a.touches[0],f=(e||a).clientX,g=(e||a).clientY;l(f+g-(this._lastX+this._lastY))>=this.options.startThreshold&&(c(document,'mousemove',this._delayedTapMove),c(document,'touchmove',this._delayedTapMove),b(document,'mousemove',this._onTapMove),b(document,'touchmove',this._onTapMove),d(this.areaElement,'display','block'))},_onTapMove(a){const b=this._targetBoundary.getBoundingClientRect(),c=a.touches&&a.touches[0];let e=(c||a).clientX,f=(c||a).clientY;e<b.x&&(e=b.x),f<b.y&&(f=b.y),e>b.x+b.width&&(e=b.x+b.width),f>b.y+b.height&&(f=b.y+b.height);const g=n(this._lastX,e),i=n(this._lastY,f),j=m(this._lastX,e),k=m(this._lastY,f);d(this.areaElement,{top:i,left:g,width:j-g,height:k-i}),this._updatedTouchingElements();const l=this._touchedElements,o=this._changedElements;h(this,'onMove',this.areaElement,a,l,o)},_onTapStop(a,b){if(d(this.areaElement,'display','none'),c(document,'mousemove',this._delayedTapMove),c(document,'touchmove',this._delayedTapMove),c(document,'mousemove',this._onTapMove),c(document,'touchmove',this._onTapMove),c(document,'mouseup',this._onTapStop),c(document,'touchcancel',this._onTapStop),c(document,'touchend',this._onTapStop),!b){this._updatedTouchingElements();const b=this._touchedElements,c=this._changedElements;h(this,'onStop',this.areaElement,a,b,c)}},_updatedTouchingElements(){const a=[],b={added:[],removed:[]},c=(c=>{!1!==g(this,'selectionFilter',c)&&f(this.areaElement,c)&&(!this._touchedElements.includes(c)&&b.added.push(c),a.push(c))}).bind(this);e(this._containers,c),this._selectables.forEach(c);const d=this._touchedElements;for(let c,e=d.length-1;0<=e;e--)c=d[e],a.includes(c)||b.removed.push(c);this._touchedElements=a,this._changedElements=b},cancel(a){this._onTapStop(null,!a)},option(a,b){const c=this.options;return void 0===b?c[a]:c[a]=b},disable(){c(document,'mousedown',this._onTapStart)},enable(){b(document,'mousedown',this._onTapStart)}},a.utils={on:b,off:c,css:d,intersects:f,traverseNode:e,selectAll:i,eventPath:j},a.create=b=>new a(b),a.version='0.0.1',a});
